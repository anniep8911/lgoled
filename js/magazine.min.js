let [crn, on, stX,edX,stY,edY] = [0,0,0,0,0,0], [now, divBy, size, crnFin] = [
    [],
    [],
    [],
    []
];
const grid = document.querySelectorAll(".grid"),
    art = document.querySelectorAll("article"),
    img = document.querySelectorAll(".ovrGrid"),
    sg = document.querySelector(".o1").getBoundingClientRect().width,
    gr = document.querySelector(".gr"),
    artGr = document.querySelector('.artGroup');

function findIdx(e) {
    for (i = 0; i < grid.length + 1; i++) {
        if (now[i] <= e && now[i + 1] >= e) return i;
        if (now[i] <= e && null == now[i + 1]) return i
    }
}

function fade(e) {
    for (size[0] = parseInt(e / (divBy[0] / 6)), img.forEach(e => {
            for (i = 1; i <= 6; i++) e.className = "ovrGrid"
        }), i = 0; i <= size[0]; i++) img[i + 1].className += " show"
}

function mvSide(e) {
    size[1] = e - now[1], size[i] >= gr.getBoundingClientRect().width - sg && (size[1] = gr.getBoundingClientRect().width - sg), gr.style.transform = `translateX(${size[1]}px)`
}
grid.forEach(e => {
    now.push(e.getBoundingClientRect().y), divBy.push(e.getBoundingClientRect().height)
}), window.addEventListener("scroll", function () {
    switch (crn = parseInt(this.pageYOffset), on = findIdx(crn), art.forEach(e => {
        e.classList.remove("on")
    }), on >= 0 && (art[on].className = "on"), on) {
        case 0:
            fade(crn);
            break;
        case 1:
            mvSide(crn)
    }
});


if(wid<=700){
    artGr.addEventListener('touchstart',function(eve){
        stX=eve.changedTouches[0].screenX;
        stY=eve.changedTouches[0].screenY;
    },false);
    artGr.addEventListener('touchend',function(eve){
        edX=eve.changedTouches[0].screenX;
        edY=eve.changedTouches[0].screenY;
        if(stX>edX && Math.abs(stY-edY)<=50){
            artGr.animate({marginLeft:'-100%'},{ duration:500, fill:'forwards'});
        }else if(stX<edX && Math.abs(stY-edY)<=50){
            artGr.animate({marginLeft:'0%'},{ duration:500, fill:'forwards'});
            
        }
    },false);
}